<HTML>
    <HEAD>
        <TITLE>Naked Chairs  | Order</TITLE>
        <meta charset='utf-8'>
        <link href="ressources/bootstrap/docs/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="style.css" rel="stylesheet">
        <STYLE>

            .list-command{
                margin-top:150px;
                margin-left:190px;
                margin-bottom:100px;
                width:700px;
                float:left;
            }
            
            .list-buy{
                margin-right:230px;
                margin-top:150px;
                margin-bottom:50px;
                float:right;
                width:350px;
            }

            #btn-group{
              float:right;
              margin-top:20px;
              margin-right:15%;
            }

            #lis{
              margin-left:auto;
              margin-right:auto;
              margin-top:150px;
              text-align: center;
              display: block;
            }

            #list-command{
              width:40%;
              display:inline-block;
            }

            #list-buy{
              width:30%;
              display:inline-block;
            }

            #listes{
              margin-top:100px;
            }

            #btnSuppr{
              float:left;
            }

            footer{
                margin-left:230px;
                margin-top:100px;
            }
        </STYLE>
    </HEAD>
    <BODY>
        <div class="navbar-wrapper">
          <div class="container">
            <nav class="navbar navbar-inverse navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <a class="navbar-brand" href="index.html"><img src="ressources/images/logo-header.png" alt="Logo" height=30px width=110px/></a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav">
                    <li class="current"><a href="index.html">Welcome</a></li>
                    <li><a class="url-nav" href="about_us.html">About Us</a></li>
                    <li><a class="url-nav" href="forums.html">Blog Chairs in the Nude</a></li>
                    <li><a class="url-nav" href="custom.html">Style up your Seats</a></li>
                    <li class="dropdown">
                      <a class="url-nav" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Shop <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                        <li><a class="url-nav" href="#">Naked Chairs Prenium</a></li>
                        <li><a class="url-nav" href="#">Naked Chairs DIY Kits</a></li>
                        <li><a class="url-nav" href="#">Choice of Fabrics</a></li>
                      </ul>
                    </li>
                    <li class = "connexion"><a class="url-nav" href="connexion.html">Connexion</a></li>
                    <li class = "connexion"><a class="url-nav" href="nouveau_compte.html">Inscription</a></li>
                  </ul>
                </div>
              </div>
            </nav>
          </div>
        </div>

          <div id="listes">
            <div id=lis>
              <ul id="list-command">
              </ul>

              <ul id="list-buy">
              </ul>
            </div>
          </div>

          <div id="btn-group" role="group" aria-label="...">
              <form action="#">
                  <input type="submit" value="VALIDER MA COMMANDE" onclick="validerCommandes()">
              </form>
              <form action="#">
                  <input type="submit" value="CONTINUER MES ACHATS" >
              </form>
              <div id="validation">
              </div>
          </div>

       
            <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="ressources/bootstrap/docs/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="ressources/bootstrap/docs/dist/js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="ressources/bootstrap/docs/assets/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="ressources/bootstrap/docs/assets/js/ie10-viewport-bug-workaround.js"></script>


    <script>

      affPanier();
      function affPanier(){
        document.getElementById("list-command").innerHTML="";
        document.getElementById("list-buy").innerHTML="";

        $.getJSON("/v1/panier", function(data) {

          var n="";
          var nPrix="";
          var s="";
          var sPrix="";
          var total=0;

          for(var i=0; i<data.length;i++){  
            if(data[i].utilisateur == "test" && data[i].valide == "Non"){
                 s+="<li class=\"list-group-item\"><input id=\"btnSuppr\" name=\""+data[i].id+"\" type=\"button\" value=\"Supprimer\" onclick=\"supprCommande(this.name)\">";
                 if(data[i].dossier=="oui"){
                  s+="Chaise ";

                  if(data[i].assise=="ronde"){
                    s+="ronde ";
                  }else{          
                    s+="rectangulaire ";
                  }

                  if(data[i].formeDossier=="ovale"){
                    s+="à dossier ovale ";
                  }else{          
                    s+="à dossier rectangulaire ";
                  }

                  if(data[i].accoudoir=="oui"){
                    s+="avec accoudoirs";
                  }else if(data[i].accoudoir=="non"){          
                    s+="sans accoudoirs";
                  }

                 }else if(data[i].dossier=="non"){
                  s+="Tabouret ";

                  if(data[i].assise=="ronde"){
                    s+="rond ";
                  }else{          
                    s+="rectangulaire ";
                  }

                 }
                 s+="</li>";
                 sPrix+="<li class=\"list-group-item\">"+data[i].prix+"€</li>";
                 total+=data[i].prix;
            }
          }
          s+="<li class=\"list-group-item\" style=\"background-color:#DCDCDC\">TOTAL</li>";
          sPrix+="<li class=\"list-group-item\" style=\"background-color:#DCDCDC\">"+total+"€</li>";
          n=$(s);
          n.appendTo("#list-command");
          nPrix=$(sPrix);
          nPrix.appendTo("#list-buy");

        });
      }

      function supprCommande(id){
         $.ajax({
                type : 'DELETE',
                contentType : 'application/json',
                url : "/v1/panier/"+id,
                dataType : "json",
                data : JSON.stringify({
                    "id" : id,
                })
            });


         affPanier();
      }

      function validerCommandes(){  
        document.getElementById("validation").innerHTML="";
        $.getJSON("/v1/panier", function(data) {
          var n="";
          var s="";
          var auMoinsUneCommande=false;
          for(var i=0; i<data.length;i++){  
            if(data[i].utilisateur == "test" && data[i].valide =="Non"){
              $.ajax({
                      type : 'PUT',
                      contentType : 'application/json',
                      url : "/v1/panier/"+data[i].id,
                      dataType : "json",
                      data : JSON.stringify({
                          "id" : data[i].id,
                      })
                  });
              auMoinsUneCommande=true;
            }
          }
            if(auMoinsUneCommande){
              s+="<p style=\"color:green\">Commande validée</p>";
              n=$(s);
              n.appendTo("#validation");
              affPanier();
            }
        });
      }


    </script>

    </BODY>
</HTML>